openapi: 3.1.0
info:
  title: HCM Backend API
  description: Human Capital Management Backend API for test drive bookings and customer management
  version: 0.1.0
  contact:
    name: API Support
    email: support@example.com
servers:
  - url: http://localhost:8080/api/v1
    description: Local development server
  - url: /api/v1
    description: API v1 base path

paths:
  /healthz:
    get:
      summary: Health Check
      description: Check if the service is healthy and running
      tags:
        - Health
      responses:
        '200':
          description: Service is healthy
          content:
            text/plain:
              schema:
                type: string
                example: "OK"
        '503':
          description: Service is unhealthy
          content:
            text/plain:
              schema:
                type: string
                example: "Service Unavailable"

  /readyz:
    get:
      summary: Readiness Check
      description: Check if the service is ready to accept requests
      tags:
        - Health
      responses:
        '200':
          description: Service is ready
          content:
            text/plain:
              schema:
                type: string
                example: "OK"
        '503':
          description: Service is not ready
          content:
            text/plain:
              schema:
                type: string
                example: "Service Not Ready"

  /metrics:
    get:
      summary: Prometheus Metrics
      description: Expose application metrics in Prometheus format
      tags:
        - Observability
      responses:
        '200':
          description: Metrics data
          content:
            text/plain:
              schema:
                type: string
                example: "# HELP go_info Information about the Go environment..."

  /users:
    get:
      summary: List users
      description: Retrieve a list of users with optional pagination and filtering
      tags:
        - Users
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: List of users retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  message:
                    type: string
                    example: 'success'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create user
      description: Create a new user
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
            example:
              name: "John Doe"
              email: "john.doe@example.com"
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
                  message:
                    type: string
                    example: 'user created successfully'
        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/{id}:
    get:
      summary: Get user by ID
      description: Retrieve a specific user by their ID
      tags:
        - Users
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: User ID
      responses:
        '200':
          description: User retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
                  message:
                    type: string
                    example: 'success'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Update user
      description: Update an existing user
      tags:
        - Users
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: User ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
                  message:
                    type: string
                    example: 'user updated successfully'
        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete user
      description: Delete a user by ID
      tags:
        - Users
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: User ID
      responses:
        '200':
          description: User deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'user deleted successfully'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /customers:
    get:
      summary: List customers
      description: Retrieve a list of customers with optional filtering
      tags:
        - Customers
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: search
          in: query
          schema:
            type: string
          description: Search term for customer names or details
        - name: oneAccountId
          in: query
          schema:
            type: string
          description: Filter by One Account ID
      responses:
        '200':
          description: List of customers retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Customer'
                  message:
                    type: string
                    example: 'success'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /webhooks/test-drive:
    post:
      summary: Test Drive Event Webhook
      description: Webhook endpoint to receive test drive booking events from external systems
      tags:
        - Webhooks
      security:
        - WebhookApiKey: []
      parameters:
        - name: X-API-Key
          in: header
          required: true
          schema:
            type: string
          description: API key for webhook authentication
        - name: X-Signature
          in: header
          required: true
          schema:
            type: string
          description: HMAC signature for payload verification
        - name: X-Event-Id
          in: header
          required: true
          schema:
            type: string
            format: uuid
          description: Unique event identifier for idempotency
        - name: X-Event-Timestamp
          in: header
          required: true
          schema:
            type: string
          description: Unix timestamp of the event
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TestDriveEvent'
            example:
              process: "test drive request"
              event_ID: "05dbe854-74a4-4e0d-be00-da098d3569d6"
              timestamp: 1698345600
              data:
                one_account:
                  one_account_ID: "GMA04GNYBSI0D85IP6K59OYGJZ6VOKW3Y"
                  first_name: "John"
                  last_name: "Doe"
                  gender: "MALE"
                  phone_number: "1234567890"
                  email: "john.doe@example.com"
                test_drive:
                  test_drive_id: "0d5be854-74a4-4e0d-be00-da098d3529d5"
                  test_drive_number: "TUT010026-02-20241107959"
                  katashiki_code: "NSP170R-MWYXKD"
                  model: "Innova Zenix"
                  variant: "2.0 Q A/T"
                  created_datetime: 1698345600
                  test_drive_datetime_start: 1698349200
                  test_drive_datetime_end: 1698352800
                  location: "DEALER"
                  outlet_ID: "AST01329"
                  outlet_name: "Astrido Toyota Bitung"
                  test_drive_status: "SUBMITTED"
                  cancellation_reason: null
                  other_cancellation_reason: null
                  customer_driving_consent: true
                leads:
                  leads_id: "44ae2529-98e4-41f4-bae8-f305f609932d"
                  leads_type: "TEST_DRIVE_REQUEST"
                  leads_follow_up_status: "ON_CONSIDERATION"
                  leads_preference_contact_time_start: "09:30"
                  leads_preference_contact_time_end: "10:30"
                  leads_source: "OFFLINE_WALK_IN_OR_CALL_IN"
                  additional_notes: null
                score:
                  tam_lead_score: "HOT"
                  outlet_lead_score: "MEDIUM"
                  parameter:
                    purchase_plan_criteria: "31_DAYS_TO_INFINITE"
                    payment_prefer_criteria: "CASH"
                    negotiation_criteria: "HAVE_STARTED_NEGOTIATIONS"
                    test_drive_criteria: "COMPLETED"
                    trade_in_criteria: "DELIVERY"
                    browsing_history_criteria: "MORE_THAN_5_PAGES"
                    vehicle_age_criteria: "MORE_THAN_2.5_YEARS"
      responses:
        '202':
          description: Test drive event accepted for processing
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      eventId:
                        type: string
                        format: uuid
                        description: The event ID that was processed
                      status:
                        type: string
                        enum: [RECEIVED]
                        description: Status of the event processing
                  message:
                    type: string
                    example: 'accepted'
        '400':
          description: Bad request - invalid payload or headers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - invalid API key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - duplicate event ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /webhooks/one-access:
    post:
      summary: One Access Account Creation Webhook
      description: Webhook endpoint to receive One Access account creation events from external systems
      tags:
        - Webhooks
      security:
        - WebhookApiKey: [ ]
      parameters:
        - name: X-API-Key
          in: header
          required: true
          schema:
            type: string
          description: API key for webhook authentication
        - name: X-Signature
          in: header
          required: true
          schema:
            type: string
          description: HMAC signature for payload verification
        - name: X-Event-Id
          in: header
          required: true
          schema:
            type: string
            format: uuid
          description: Unique event identifier for idempotency
        - name: X-Event-Timestamp
          in: header
          required: true
          schema:
            type: string
          description: Unix timestamp of the event
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OneAccessEvent'
            example:
              process: "one access create"
              event_ID: "05dbe854-74a4-4e0d-be00-da098d3569d6"
              timestamp: 1698345600
              data:
                one_account:
                  one_account_ID: "GMA04GNYBSI0D85IP6K59OYGJZ6VOKW3Y"
                  dealer_customer_ID: "DLC-20241107-001"
                  first_name: "John"
                  last_name: "Doe"
                  phone_number: "081234567890"
                  email: "john.doe@example.com"
                  birth_date: "1990-05-21"
                  verification_channel: "WHATSAPP"
                  ktp_number: "3273012105900001"
                  occupation: "Engineer"
                  gender: "MALE"
                  registration_channel: "DEALER_SYSTEM"
                  registration_datetime: 1698349200
                  consent_given: true
                  consent_given_at: 1698349300
                  consent_given_during: "REGISTRATION"
                  address_label: "Rumah"
                  residence_address: "Jalan Merdeka No. 10"
                  province: "DKI Jakarta"
                  city: "Jakarta Pusat"
                  district: "Menteng"
                  subdistrict: "Pegangsaan"
                  postal_code: "10320"
                  detail_address: "RT 05 / RW 02"
      responses:
        '202':
          description: One Access event accepted for processing
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      eventId:
                        type: string
                        format: uuid
                        description: The event ID that was processed
                      status:
                        type: string
                        enum: [ RECEIVED ]
                        description: Status of the event processing
                  message:
                    type: string
                    example: 'accepted'
        '400':
          description: Bad request - invalid payload or headers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - invalid API key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - duplicate event ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /webhooks/toyota-id:
    post:
      summary: Toyota ID Creation Webhook
      description: Webhook endpoint to receive Toyota ID (One Account + Customer Vehicle) creation events.
      tags:
        - Webhooks
      security:
        - WebhookApiKey: [ ]
      parameters:
        - name: X-API-Key
          in: header
          required: true
          schema:
            type: string
          description: API key for webhook authentication
        - name: X-Signature
          in: header
          required: true
          schema:
            type: string
          description: HMAC SHA-256 of the raw request body, hex-encoded
        - name: X-Event-Id
          in: header
          required: true
          schema:
            type: string
            format: uuid
          description: Unique event identifier for idempotency
        - name: X-Event-Timestamp
          in: header
          required: true
          schema:
            type: string
          description: Unix timestamp of the event as string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ToyotaIdRequest'
            example:
              process: "toyota id creation"
              event_ID: "d4d7402f-dcab-443d-a829-f1817085f8da"
              timestamp: 1731229200
              data:
                one_account:
                  one_account_ID: "GMO4GNYBSI0D85IP6K59OYGJZ6VOKW3Y"
                  dealer_customer_ID: "ASTVAJMF00552"
                  first_name: "Nkoc"
                  last_name: "Maf"
                  phone_number: "081234567890"
                  email: "nkoc.maf@example.com"
                  birth_date: "1995-08-12"
                  verification_channel: "SMS"
                  ktp_number: "PRRJKAESWC086H"
                  occupation: "Engineer"
                  gender: "FEMALE"
                  address_label: "Rumah"
                  residence_address: "52EXP0ADG Q9G3AAD T, WI YktLIL ONb2 gSLTo a6pP YXZJ, NIl1n"
                  province: "DKI Jakarta"
                  city: "Jakarta Barat"
                  district: "Pulo Gadung"
                  subdistrict: "Jati"
                  postal_code: "13220"
                  detail_address: "gts89detiyt"
                  registration_channel: "MTOYOTA"
                  registration_datetime: 1731229200
                  consent_given: true
                  consent_given_at: 1731229200
                  consent_given_during: "REGISTRATION"
                  toyota_single_ID_status: "ACTIVE"
                  customer_category: "INDIVIDUAL"
                customer_vehicle:
                  primary_user: "MASTER"
                  vin: "MKFZKE81SCJ115045"
                  police_number: "B1234ABC"
                  katashiki_suffix: "NSP170R-MWYQKD02"
                  color_code: "59"
                  model: "Innova Zenix"
                  variant: "2.0 Q A/T"
                  color: "Putih"
                  stnk_number: "aVZGjcOK"
                  stnk_name: "uHwG2zT"
                  stnk_expiry_date: 1731229200
                  stnk_address: "52EXP0ADG Q9G3AAD T, WI YktLIL ONb2 gSLTo a6pP YXZJ"
                  customer_type: [ "BUYER", "OWNER" ]
                  vehicle_category: "RETAIL"
      responses:
        '202':
          description: Event accepted for processing
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      eventId:
                        type: string
                        format: uuid
                      status:
                        type: string
                        enum: [ RECEIVED ]
                  message:
                    type: string
                    example: accepted
        '400':
          description: Bad request - invalid payload or headers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - invalid API key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - duplicate event ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          description: User ID
        name:
          type: string
          description: User name
        email:
          type: string
          format: email
          description: User email
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp

    CreateUserRequest:
      type: object
      required:
        - name
        - email
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: User name
        email:
          type: string
          format: email
          description: User email address

    UpdateUserRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: User name
        email:
          type: string
          format: email
          description: User email address

    Customer:
      type: object
      properties:
        oneAccountId:
          type: string
          description: One Account ID
        firstName:
          type: string
          description: Customer first name
        lastName:
          type: string
          description: Customer last name
        gender:
          type: string
          enum: [MALE, FEMALE]
          description: Customer gender
        phoneNumber:
          type: string
          description: Customer phone number
        email:
          type: string
          format: email
          description: Customer email address

    TestDriveEvent:
      type: object
      required:
        - process
        - event_ID
        - timestamp
        - data
      properties:
        process:
          type: string
          enum: ["test drive request"]
          description: Process type identifier
        event_ID:
          type: string
          format: uuid
          description: Unique event identifier
        timestamp:
          type: integer
          format: int64
          description: Unix timestamp of the event
        data:
          $ref: '#/components/schemas/TestDriveEventData'

    TestDriveEventData:
      type: object
      required:
        - one_account
        - test_drive
        - leads
        - score
      properties:
        one_account:
          $ref: '#/components/schemas/OneAccountRequest'
        test_drive:
          $ref: '#/components/schemas/TestDriveRequest'
        leads:
          $ref: '#/components/schemas/LeadsRequest'
        score:
          $ref: '#/components/schemas/Score'

    OneAccountRequest:
      type: object
      required:
        - one_account_ID
        - first_name
        - last_name
        - gender
        - phone_number
      properties:
        one_account_ID:
          type: string
          description: One Account unique identifier
        first_name:
          type: string
          description: Customer first name
        last_name:
          type: string
          description: Customer last name
        gender:
          type: string
          enum: [MALE, FEMALE]
          description: Customer gender
        phone_number:
          type: string
          description: Customer phone number
        email:
          type: string
          format: email
          description: Customer email address

    TestDriveRequest:
      type: object
      required:
        - test_drive_id
        - test_drive_number
        - katashiki_code
        - model
        - variant
        - created_datetime
        - test_drive_datetime_start
        - test_drive_datetime_end
        - location
        - outlet_ID
        - outlet_name
        - test_drive_status
        - customer_driving_consent
      properties:
        test_drive_id:
          type: string
          description: Test drive unique identifier
        test_drive_number:
          type: string
          description: Test drive booking number
        katashiki_code:
          type: string
          description: Vehicle katashiki code
        model:
          type: string
          description: Vehicle model
        variant:
          type: string
          description: Vehicle variant
        created_datetime:
          type: integer
          format: int64
          description: Creation timestamp
        test_drive_datetime_start:
          type: integer
          format: int64
          description: Test drive start time
        test_drive_datetime_end:
          type: integer
          format: int64
          description: Test drive end time
        location:
          type: string
          description: Test drive location
        outlet_ID:
          type: string
          description: Outlet identifier
        outlet_name:
          type: string
          description: Outlet name
        test_drive_status:
          type: string
          enum: [SUBMITTED, CHANGE_REQUEST, CANCEL_SUBMITTED]
          description: Test drive status
        cancellation_reason:
          type: string
          nullable: true
          description: Reason for cancellation
        other_cancellation_reason:
          type: string
          nullable: true
          description: Other cancellation reason
        customer_driving_consent:
          type: boolean
          description: Customer driving consent flag

    LeadsRequest:
      type: object
      required:
        - leads_id
        - leads_type
        - leads_follow_up_status
        - leads_preference_contact_time_start
        - leads_preference_contact_time_end
        - leads_source
      properties:
        leads_id:
          type: string
          description: Lead unique identifier
        leads_type:
          type: string
          description: Type of lead
        leads_follow_up_status:
          type: string
          description: Lead follow-up status
        leads_preference_contact_time_start:
          type: string
          description: Preferred contact time start
        leads_preference_contact_time_end:
          type: string
          description: Preferred contact time end
        leads_source:
          type: string
          description: Source of the lead
        additional_notes:
          type: string
          nullable: true
          description: Additional notes for the lead

    Score:
      type: object
      required:
        - tam_lead_score
        - outlet_lead_score
        - parameter
      properties:
        tam_lead_score:
          type: string
          description: TAM lead score
        outlet_lead_score:
          type: string
          description: Outlet lead score
        parameter:
          $ref: '#/components/schemas/ScoreParameter'

    ScoreParameter:
      type: object
      required:
        - purchase_plan_criteria
        - payment_prefer_criteria
        - negotiation_criteria
        - test_drive_criteria
        - trade_in_criteria
        - browsing_history_criteria
        - vehicle_age_criteria
      properties:
        purchase_plan_criteria:
          type: string
          description: Purchase plan criteria
        payment_prefer_criteria:
          type: string
          description: Payment preference criteria
        negotiation_criteria:
          type: string
          description: Negotiation criteria
        test_drive_criteria:
          type: string
          description: Test drive criteria
        trade_in_criteria:
          type: string
          description: Trade-in criteria
        browsing_history_criteria:
          type: string
          description: Browsing history criteria
        vehicle_age_criteria:
          type: string
          description: Vehicle age criteria

    OneAccessEvent:
      type: object
      required:
        - process
        - event_ID
        - timestamp
        - data
      properties:
        process:
          type: string
          description: Process type identifier
          example: "one access create"
        event_ID:
          type: string
          format: uuid
          description: Unique event identifier (UUID v4)
        timestamp:
          type: integer
          format: int64
          description: Unix timestamp of the event
        data:
          $ref: '#/components/schemas/OneAccessEventData'

    OneAccessEventData:
      type: object
      required:
        - one_account
      properties:
        one_account:
          $ref: '#/components/schemas/OneAccountCreateRequest'

    OneAccountCreateRequest:
      type: object
      properties:
        one_account_ID:
          type: string
          description: One Account unique identifier
          maxLength: 32
        dealer_customer_ID:
          type: string
          description: Dealer customer identifier
          maxLength: 32
        first_name:
          type: string
          description: Customer first name
          maxLength: 64
        last_name:
          type: string
          description: Customer last name
          maxLength: 64
        phone_number:
          type: string
          description: Customer phone number
          maxLength: 16
        email:
          type: string
          format: email
          description: Customer email address
          maxLength: 64
        birth_date:
          type: string
          description: Birth date (YYYY-MM-DD)
          maxLength: 32
          example: "1990-05-21"
        verification_channel:
          type: string
          description: Verification channel
          enum: [ SMS, WHATSAPP, EMAIL ]
        ktp_number:
          type: string
          description: Indonesian KTP number
          maxLength: 16
        occupation:
          type: string
          description: Occupation
          maxLength: 64
        gender:
          type: string
          description: Gender
          enum: [ FEMALE, MALE, OTHER ]
        registration_channel:
          type: string
          description: Registration channel
          enum: [ MTOYOTA, DXMI, DEALER_SYSTEM ]
        registration_datetime:
          type: integer
          format: int64
          description: Registration timestamp (Unix)
        consent_given:
          type: boolean
          description: Whether consent was given
        consent_given_at:
          type: integer
          format: int64
          description: Consent timestamp (Unix)
        consent_given_during:
          type: string
          description: Flow where consent was obtained
          enum: [ REGISTRATION, SPK, SERVICE, ADD_VEHICLE ]
        address_label:
          type: string
          description: Address label
          maxLength: 256
        residence_address:
          type: string
          description: Residence address
          maxLength: 256
        province:
          type: string
          description: Province
          maxLength: 64
        city:
          type: string
          description: City
          maxLength: 64
        district:
          type: string
          description: District
          maxLength: 64
        subdistrict:
          type: string
          description: Subdistrict
          maxLength: 64
        postal_code:
          type: string
          description: Postal code (5 digits)
          pattern: '^\d{5}$'
        detail_address:
          type: string
          description: Address details
          maxLength: 256
      required:
        - dealer_customer_ID
        - first_name
        - last_name
        - phone_number
        - verification_channel
        - ktp_number
        - registration_channel
        - registration_datetime
        - consent_given
        - consent_given_at
        - consent_given_during
    ToyotaIdRequest:
      type: object
      required: [ process, event_ID, timestamp, data ]
      properties:
        process:
          type: string
          description: Process type identifier
          example: "toyota id creation"
        event_ID:
          type: string
          format: uuid
          description: Unique event identifier (UUID v4)
        timestamp:
          type: integer
          format: int64
          description: Unix timestamp of the event
        data:
          $ref: '#/components/schemas/ToyotaIdData'

    ToyotaIdData:
      type: object
      required: [ one_account, customer_vehicle ]
      properties:
        one_account:
          $ref: '#/components/schemas/ToyotaIdOneAccount'
        customer_vehicle:
          $ref: '#/components/schemas/ToyotaIdCustomerVehicle'

    ToyotaIdOneAccount:
      type: object
      properties:
        one_account_ID:
          type: string
          maxLength: 32
        dealer_customer_ID:
          type: string
          maxLength: 32
        first_name:
          type: string
          maxLength: 64
        last_name:
          type: string
          maxLength: 64
        phone_number:
          type: string
          maxLength: 16
        email:
          type: string
          format: email
          maxLength: 64
        birth_date:
          type: string
          description: Birth date (YYYY-MM-DD)
          example: "1995-08-12"
        verification_channel:
          type: string
          enum: [ SMS, WHATSAPP, EMAIL ]
        ktp_number:
          type: string
          maxLength: 32
        occupation:
          type: string
          maxLength: 64
        gender:
          type: string
          enum: [ FEMALE, MALE, OTHER ]
        address_label:
          type: string
          maxLength: 256
        residence_address:
          type: string
          maxLength: 256
        province:
          type: string
          maxLength: 64
        city:
          type: string
          maxLength: 64
        district:
          type: string
          maxLength: 64
        subdistrict:
          type: string
          maxLength: 64
        postal_code:
          type: string
          maxLength: 16
        detail_address:
          type: string
          maxLength: 256
        registration_channel:
          type: string
          enum: [ MTOYOTA, DXMI, DEALER_SYSTEM ]
        registration_datetime:
          type: integer
          format: int64
        consent_given:
          type: boolean
        consent_given_at:
          type: integer
          format: int64
        consent_given_during:
          type: string
          enum: [ REGISTRATION, SPK, SERVICE, ADD_VEHICLE ]
        toyota_single_ID_status:
          type: string
          enum: [ ACTIVE, INACTIVE, DELETED ]
        customer_category:
          type: string
          enum: [ INDIVIDUAL, COMPANY ]
        ktp_image:
          type: string
          description: Base64-encoded image (optional)
      required:
        - one_account_ID
        - dealer_customer_ID
        - first_name
        - last_name
        - phone_number
        - verification_channel
        - ktp_number

    ToyotaIdCustomerVehicle:
      type: object
      properties:
        primary_user:
          type: string
          enum: [ MASTER, MEMBER ]
        vin:
          type: string
          maxLength: 17
        police_number:
          type: string
          maxLength: 16
        katashiki_suffix:
          type: string
          maxLength: 64
        color_code:
          type: string
          maxLength: 16
        model:
          type: string
          maxLength: 64
        variant:
          type: string
          maxLength: 128
        color:
          type: string
          maxLength: 64
        stnk_number:
          type: string
          maxLength: 32
        stnk_name:
          type: string
          maxLength: 64
        stnk_expiry_date:
          type: integer
          format: int64
        stnk_address:
          type: string
          maxLength: 256
        customer_type:
          type: array
          items:
            type: string
            enum: [ OWNER, BUYER, USER ]
          minItems: 1
          uniqueItems: true
        vehicle_category:
          type: string
          enum: [ RETAIL, FLEET ]
        stnk_image:
          type: string
          description: Base64-encoded image (optional)
      required:
        - vin
        - police_number
        - katashiki_suffix
        - color_code
        - model
        - variant
        - color
        - customer_type
        - vehicle_category

    ErrorResponse:
      type: object
      properties:
        data:
          type: object
          additionalProperties: true
          description: Error details and context
        message:
          type: string
          description: Error message

  securitySchemes:
    WebhookApiKey:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for webhook authentication
